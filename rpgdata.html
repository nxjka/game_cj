<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RPG游戏数据检测器 - JSON转Excel转换器</title>
    <script src="https://unpkg.com/xlsx/dist/xlsx.full.min.js"></script>
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background: linear-gradient(135deg, #1a2a6c, #b21f1f, #fdbb2d);
            color: #333;
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            padding: 30px;
            backdrop-filter: blur(10px);
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding-bottom: 20px;
            border-bottom: 2px solid #eee;
        }
        
        h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 2.5rem;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.1);
        }
        
        .subtitle {
            color: #7f8c8d;
            font-size: 1.2rem;
        }
        
        .upload-area {
            border: 3px dashed #3498db;
            border-radius: 10px;
            padding: 40px 20px;
            text-align: center;
            margin-bottom: 30px;
            transition: all 0.3s ease;
            background-color: #f8fafc;
            cursor: pointer;
        }
        
        .upload-area:hover, .upload-area.dragover {
            background-color: #e8f4fc;
            border-color: #2980b9;
            transform: translateY(-5px);
        }
        
        .upload-icon {
            font-size: 64px;
            color: #3498db;
            margin-bottom: 15px;
        }
        
        .upload-area p {
            margin-bottom: 15px;
            color: #7f8c8d;
            font-size: 1.1rem;
        }
        
        .btn {
            display: inline-block;
            background: #3498db;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
            font-weight: 600;
            box-shadow: 0 4px 6px rgba(50, 50, 93, 0.11), 0 1px 3px rgba(0, 0, 0, 0.08);
        }
        
        .btn:hover {
            background: #2980b9;
            transform: translateY(-2px);
            box-shadow: 0 7px 14px rgba(50, 50, 93, 0.1), 0 3px 6px rgba(0, 0, 0, 0.08);
        }
        
        .btn-success {
            background: #2ecc71;
        }
        
        .btn-success:hover {
            background: #27ae60;
        }
        
        .btn-warning {
            background: #f39c12;
        }
        
        .btn-warning:hover {
            background: #e67e22;
        }
        
        .file-input {
            display: none;
        }
        
        .results-container {
            margin-top: 30px;
            display: none;
        }
        
        .data-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .data-card {
            background: white;
            border-radius: 10px;
            padding: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s;
            border-left: 5px solid #3498db;
        }
        
        .data-card:hover {
            transform: translateY(-5px);
        }
        
        .data-card.item {
            border-left-color: #2ecc71;
        }
        
        .data-card.character {
            border-left-color: #e74c3c;
        }
        
        .data-card.event {
            border-left-color: #f39c12;
        }
        
        .data-card.map {
            border-left-color: #9b59b6;
        }
        
        .data-card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .data-type {
            font-size: 14px;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-weight: bold;
        }
        
        .data-type.item {
            background: #2ecc71;
        }
        
        .data-type.character {
            background: #e74c3c;
        }
        
        .data-type.event {
            background: #f39c12;
        }
        
        .data-type.map {
            background: #9b59b6;
        }
        
        .data-count {
            font-size: 24px;
            font-weight: bold;
            color: #2c3e50;
        }
        
        .data-stats {
            display: flex;
            justify-content: space-between;
            margin-top: 10px;
        }
        
        .stat {
            text-align: center;
        }
        
        .stat-value {
            font-size: 18px;
            font-weight: bold;
            color: #3498db;
        }
        
        .stat-label {
            font-size: 12px;
            color: #7f8c8d;
        }
        
        .preview-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            border-radius: 8px;
            overflow: hidden;
        }
        
        .preview-table th {
            background: #3498db;
            color: white;
            padding: 12px 15px;
            text-align: left;
        }
        
        .preview-table td {
            padding: 10px 15px;
            border-bottom: 1px solid #eee;
        }
        
        .preview-table tr:hover {
            background-color: #f5f5f5;
        }
        
        .error-message {
            background: #e74c3c;
            color: white;
            padding: 12px 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .success-message {
            background: #2ecc71;
            color: white;
            padding: 12px 15px;
            border-radius: 6px;
            margin-top: 15px;
            display: none;
        }
        
        .loader {
            border: 5px solid #f3f3f3;
            border-top: 5px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
            display: none;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .actions {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-top: 30px;
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        
        .tab {
            padding: 12px 24px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            transition: all 0.3s;
        }
        
        .tab.active {
            border-bottom: 3px solid #3498db;
            color: #3498db;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .issues-list {
            margin-top: 20px;
        }
        
        .issue {
            padding: 10px 15px;
            margin-bottom: 10px;
            border-radius: 6px;
            background: #fff3cd;
            border-left: 4px solid #ffc107;
        }
        
        .issue.error {
            background: #f8d7da;
            border-left-color: #dc3545;
        }
        
        .issue.warning {
            background: #fff3cd;
            border-left-color: #ffc107;
        }
        
        .issue.info {
            background: #d1ecf1;
            border-left-color: #17a2b8;
        }
        
        .progress-bar {
            height: 10px;
            background: #ecf0f1;
            border-radius: 5px;
            margin-top: 10px;
            overflow: hidden;
        }
        
        .progress {
            height: 100%;
            background: #3498db;
            border-radius: 5px;
            width: 0%;
            transition: width 0.5s;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>RPG游戏数据检测器</h1>
            <p class="subtitle">将JSON数据转换为Excel表格格式</p>
        </header>
        
        <div class="upload-area" id="uploadArea">
            <div class="upload-icon">⚔️</div>
            <h3>拖拽RPG数据JSON文件到此处或点击上传</h3>
            <p>支持物品、人物、事件、地图等多种RPG数据格式</p>
            <button class="btn" id="browseBtn">选择文件</button>
            <input type="file" id="fileInput" class="file-input" accept=".json" multiple>
        </div>
        
        <div class="loader" id="loader"></div>
        
        <div class="error-message" id="errorMessage"></div>
        <div class="success-message" id="successMessage"></div>
        
        <div class="results-container" id="resultsContainer">
            <div class="data-cards" id="dataCards">
                <!-- 数据卡片将通过JavaScript动态生成 -->
            </div>
            
            <div class="tabs">
                <div class="tab active" data-tab="preview">数据预览</div>
                <div class="tab" data-tab="issues">问题检测</div>
                <div class="tab" data-tab="structure">数据结构</div>
            </div>
            
            <div class="tab-content active" id="preview">
                <div class="table-container">
                    <table class="preview-table" id="previewTable">
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>名称</th>
                                <th>类型</th>
                                <th>描述</th>
                                <th>数值</th>
                            </tr>
                        </thead>
                        <tbody id="previewTableBody">
                            <!-- 表格数据将通过JavaScript动态填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
            
            <div class="tab-content" id="issues">
                <h3>数据问题检测</h3>
                <div class="progress-bar">
                    <div class="progress" id="progressBar" style="width: 0%"></div>
                </div>
                <div class="issues-list" id="issuesList">
                    <!-- 问题列表将通过JavaScript动态填充 -->
                </div>
            </div>
            
            <div class="tab-content" id="structure">
                <h3>数据结构分析</h3>
                <div id="structureViewer">
                    <!-- 结构分析将通过JavaScript动态填充 -->
                </div>
            </div>
            
            <div class="actions">
                <button class="btn btn-success" id="exportBtn">导出Excel</button>
                <button class="btn btn-warning" id="analyzeBtn">分析数据</button>
                <button class="btn" id="resetBtn">重置</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // 获取DOM元素
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            const browseBtn = document.getElementById('browseBtn');
            const resultsContainer = document.getElementById('resultsContainer');
            const dataCards = document.getElementById('dataCards');
            const previewTableBody = document.getElementById('previewTableBody');
            const errorMessage = document.getElementById('errorMessage');
            const successMessage = document.getElementById('successMessage');
            const loader = document.getElementById('loader');
            const exportBtn = document.getElementById('exportBtn');
            const analyzeBtn = document.getElementById('analyzeBtn');
            const resetBtn = document.getElementById('resetBtn');
            const tabs = document.querySelectorAll('.tab');
            const tabContents = document.querySelectorAll('.tab-content');
            const issuesList = document.getElementById('issuesList');
            const progressBar = document.getElementById('progressBar');
            const structureViewer = document.getElementById('structureViewer');
            
            // 存储解析后的数据
            let parsedData = {
                items: [],
                characters: [],
                events: [],
                maps: [],
                others: []
            };
            
            let currentFileIndex = 0;
            let allFiles = [];
            
            // 点击上传区域触发文件选择
            browseBtn.addEventListener('click', function() {
                fileInput.click();
            });
            
            // 文件选择变化事件
            fileInput.addEventListener('change', function(e) {
                handleFiles(e.target.files);
            });
            
            // 拖拽事件处理
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function() {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                handleFiles(e.dataTransfer.files);
            });
            
            // 标签页切换
            tabs.forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabId = this.getAttribute('data-tab');
                    
                    // 更新活动标签
                    tabs.forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    
                    // 显示对应内容
                    tabContents.forEach(content => {
                        content.classList.remove('active');
                        if (content.id === tabId) {
                            content.classList.add('active');
                        }
                    });
                });
            });
            
            // 导出Excel
            exportBtn.addEventListener('click', function() {
                if (isDataEmpty()) {
                    showError('没有可导出的数据');
                    return;
                }
                
                try {
                    // 创建工作簿
                    const wb = XLSX.utils.book_new();
                    
                    // 为每种数据类型创建工作表
                    for (const dataType in parsedData) {
                        if (parsedData[dataType].length > 0) {
                            const worksheet = XLSX.utils.json_to_sheet(parsedData[dataType]);
                            XLSX.utils.book_append_sheet(wb, worksheet, capitalizeFirstLetter(dataType));
                        }
                    }
                    
                    // 生成Excel文件并下载
                    XLSX.writeFile(wb, 'RPG_Data_Analysis.xlsx');
                    showSuccess('Excel文件导出成功');
                } catch (error) {
                    showError('导出Excel时发生错误: ' + error.message);
                }
            });
            
            // 分析数据
            analyzeBtn.addEventListener('click', function() {
                analyzeData();
            });
            
            // 重置
            resetBtn.addEventListener('click', function() {
                fileInput.value = '';
                parsedData = {
                    items: [],
                    characters: [],
                    events: [],
                    maps: [],
                    others: []
                };
                resultsContainer.style.display = 'none';
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                issuesList.innerHTML = '';
                progressBar.style.width = '0%';
            });
            
            // 处理上传的文件
            function handleFiles(files) {
                if (files.length === 0) return;
                
                // 重置状态
                parsedData = {
                    items: [],
                    characters: [],
                    events: [],
                    maps: [],
                    others: []
                };
                currentFileIndex = 0;
                allFiles = Array.from(files);
                errorMessage.style.display = 'none';
                successMessage.style.display = 'none';
                
                // 显示加载动画
                loader.style.display = 'block';
                resultsContainer.style.display = 'none';
                
                // 处理文件
                processFiles();
            }
            
            // 处理文件队列
            function processFiles() {
                if (currentFileIndex >= allFiles.length) {
                    // 所有文件处理完成
                    loader.style.display = 'none';
                    displayResults();
                    return;
                }
                
                const file = allFiles[currentFileIndex];
                
                // 检查文件类型
                if (!file.name.toLowerCase().endsWith('.json')) {
                    showError(`文件 "${file.name}" 不是JSON格式`);
                    currentFileIndex++;
                    processFiles();
                    return;
                }
                
                // 检查文件大小 (限制5MB)
                if (file.size > 5 * 1024 * 1024) {
                    showError(`文件 "${file.name}" 超过5MB限制`);
                    currentFileIndex++;
                    processFiles();
                    return;
                }
                
                const reader = new FileReader();
                
                reader.onload = function(e) {
                    try {
                        const jsonData = JSON.parse(e.target.result);
                        categorizeData(jsonData, file.name);
                        
                        currentFileIndex++;
                        processFiles();
                    } catch (error) {
                        showError(`文件 "${file.name}" 解析失败: ${error.message}`);
                        currentFileIndex++;
                        processFiles();
                    }
                };
                
                reader.onerror = function() {
                    showError(`读取文件 "${file.name}" 时发生错误`);
                    currentFileIndex++;
                    processFiles();
                };
                
                reader.readAsText(file);
            }
            
            // 分类数据
            function categorizeData(data, fileName) {
                // 如果数据是数组，处理每个元素
                if (Array.isArray(data)) {
                    data.forEach(item => {
                        addToCategory(item, fileName);
                    });
                } else {
                    // 如果数据是对象，直接处理
                    addToCategory(data, fileName);
                }
            }
            
            // 将数据添加到相应类别
            function addToCategory(item, fileName) {
                // 添加文件名信息
                item.sourceFile = fileName;
                
                // 根据数据特征判断类型
                if (item.type === 'item' || item.itemType || item.equipmentSlot) {
                    parsedData.items.push(item);
                } else if (item.type === 'character' || item.characterClass || item.level) {
                    parsedData.characters.push(item);
                } else if (item.type === 'event' || item.eventType || item.trigger) {
                    parsedData.events.push(item);
                } else if (item.type === 'map' || item.mapType || item.coordinates) {
                    parsedData.maps.push(item);
                } else {
                    parsedData.others.push(item);
                }
            }
            
            // 显示解析结果
            function displayResults() {
                if (isDataEmpty()) {
                    showError('没有成功解析任何数据');
                    return;
                }
                
                // 更新数据卡片
                updateDataCards();
                
                // 更新预览表格
                updatePreviewTable();
                
                // 显示结果容器
                resultsContainer.style.display = 'block';
                
                // 显示成功消息
                const totalItems = getTotalItems();
                showSuccess(`成功解析 ${allFiles.length} 个文件，共 ${totalItems} 条数据记录`);
            }
            
            // 更新数据卡片
            function updateDataCards() {
                dataCards.innerHTML = '';
                
                const categories = [
                    { key: 'items', name: '物品', icon: '🛡️' },
                    { key: 'characters', name: '人物', icon: '🧙' },
                    { key: 'events', name: '事件', icon: '📜' },
                    { key: 'maps', name: '地图', icon: '🗺️' },
                    { key: 'others', name: '其他', icon: '📁' }
                ];
                
                categories.forEach(category => {
                    if (parsedData[category.key].length > 0) {
                        const card = document.createElement('div');
                        card.className = `data-card ${category.key}`;
                        
                        const stats = calculateStats(parsedData[category.key]);
                        
                        card.innerHTML = `
                            <div class="data-card-header">
                                <div>
                                    <h3>${category.icon} ${category.name}</h3>
                                    <div class="data-type ${category.key}">${category.name}</div>
                                </div>
                                <div class="data-count">${parsedData[category.key].length}</div>
                            </div>
                            <div class="data-stats">
                                <div class="stat">
                                    <div class="stat-value">${stats.uniqueKeys}</div>
                                    <div class="stat-label">唯一字段</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">${stats.avgProps}</div>
                                    <div class="stat-label">平均属性</div>
                                </div>
                                <div class="stat">
                                    <div class="stat-value">${stats.maxDepth}</div>
                                    <div class="stat-label">最大深度</div>
                                </div>
                            </div>
                        `;
                        
                        dataCards.appendChild(card);
                    }
                });
            }
            
            // 更新预览表格
            function updatePreviewTable() {
                previewTableBody.innerHTML = '';
                
                // 合并所有数据用于预览（限制前50条）
                const allData = [
                    ...parsedData.items.slice(0, 10),
                    ...parsedData.characters.slice(0, 10),
                    ...parsedData.events.slice(0, 10),
                    ...parsedData.maps.slice(0, 10),
                    ...parsedData.others.slice(0, 10)
                ];
                
                allData.forEach(item => {
                    const row = document.createElement('tr');
                    
                    // 获取ID
                    const id = item.id || item.itemId || item.characterId || item.eventId || item.mapId || 'N/A';
                    
                    // 获取名称
                    const name = item.name || item.itemName || item.characterName || item.eventName || item.mapName || '未命名';
                    
                    // 获取类型
                    let type = '未知';
                    if (parsedData.items.includes(item)) type = '物品';
                    else if (parsedData.characters.includes(item)) type = '人物';
                    else if (parsedData.events.includes(item)) type = '事件';
                    else if (parsedData.maps.includes(item)) type = '地图';
                    else type = '其他';
                    
                    // 获取描述
                    const description = item.description || item.desc || item.info || '无描述';
                    
                    // 获取数值（尝试找到有意义的数值字段）
                    let value = 'N/A';
                    if (item.value !== undefined) value = item.value;
                    else if (item.price !== undefined) value = item.price;
                    else if (item.cost !== undefined) value = item.cost;
                    else if (item.power !== undefined) value = item.power;
                    else if (item.level !== undefined) value = item.level;
                    
                    row.innerHTML = `
                        <td>${id}</td>
                        <td>${name}</td>
                        <td>${type}</td>
                        <td>${truncateText(description, 50)}</td>
                        <td>${value}</td>
                    `;
                    
                    previewTableBody.appendChild(row);
                });
            }
            
            // 分析数据
            function analyzeData() {
                if (isDataEmpty()) {
                    showError('没有可分析的数据');
                    return;
                }
                
                issuesList.innerHTML = '';
                progressBar.style.width = '0%';
                
                // 模拟分析进度
                let progress = 0;
                const interval = setInterval(() => {
                    progress += 5;
                    progressBar.style.width = `${progress}%`;
                    
                    if (progress >= 100) {
                        clearInterval(interval);
                        performDataAnalysis();
                    }
                }, 100);
            }
            
            // 执行数据分析
            function performDataAnalysis() {
                const issues = [];
                
                // 检查物品数据
                parsedData.items.forEach(item => {
                    if (!item.id) {
                        issues.push({
                            type: 'error',
                            message: `物品 "${item.name || '未命名'}" 缺少ID`,
                            category: '物品'
                        });
                    }
                    
                    if (!item.name) {
                        issues.push({
                            type: 'warning',
                            message: `物品(ID: ${item.id || '未知'}) 缺少名称`,
                            category: '物品'
                        });
                    }
                    
                    if (item.value === undefined) {
                        issues.push({
                            type: 'warning',
                            message: `物品 "${item.name || '未命名'}" 缺少价值属性`,
                            category: '物品'
                        });
                    }
                });
                
                // 检查人物数据
                parsedData.characters.forEach(character => {
                    if (!character.id) {
                        issues.push({
                            type: 'error',
                            message: `人物 "${character.name || '未命名'}" 缺少ID`,
                            category: '人物'
                        });
                    }
                    
                    if (!character.name) {
                        issues.push({
                            type: 'warning',
                            message: `人物(ID: ${character.id || '未知'}) 缺少名称`,
                            category: '人物'
                        });
                    }
                    
                    if (character.level === undefined) {
                        issues.push({
                            type: 'info',
                            message: `人物 "${character.name || '未命名'}" 缺少等级属性`,
                            category: '人物'
                        });
                    }
                });
                
                // 检查重复ID
                const allIds = {};
                
                for (const category in parsedData) {
                    parsedData[category].forEach(item => {
                        if (item.id) {
                            if (!allIds[item.id]) {
                                allIds[item.id] = [];
                            }
                            allIds[item.id].push({
                                name: item.name || '未命名',
                                category: category
                            });
                        }
                    });
                }
                
                for (const id in allIds) {
                    if (allIds[id].length > 1) {
                        issues.push({
                            type: 'error',
                            message: `ID "${id}" 在多个条目中重复使用: ${allIds[id].map(i => `${i.name}(${i.category})`).join(', ')}`,
                            category: '数据完整性'
                        });
                    }
                }
                
                // 显示问题
                displayIssues(issues);
                
                // 更新结构分析
                updateStructureAnalysis();
            }
            
            // 显示问题列表
            function displayIssues(issues) {
                if (issues.length === 0) {
                    issuesList.innerHTML = '<div class="issue info">未发现数据问题</div>';
                    return;
                }
                
                issues.forEach(issue => {
                    const issueElement = document.createElement('div');
                    issueElement.className = `issue ${issue.type}`;
                    issueElement.innerHTML = `
                        <strong>${issue.category}</strong>: ${issue.message}
                    `;
                    issuesList.appendChild(issueElement);
                });
            }
            
            // 更新结构分析
            function updateStructureAnalysis() {
                let structureHTML = '';
                
                for (const category in parsedData) {
                    if (parsedData[category].length > 0) {
                        structureHTML += `<h4>${capitalizeFirstLetter(category)} 数据结构</h4>`;
                        
                        const sample = parsedData[category][0];
                        const keys = Object.keys(sample);
                        
                        structureHTML += `<p>字段数量: ${keys.length}</p>`;
                        structureHTML += `<ul>`;
                        
                        keys.forEach(key => {
                            const value = sample[key];
                            const type = typeof value;
                            structureHTML += `<li><strong>${key}</strong>: ${type} ${Array.isArray(value) ? '(数组)' : ''} ${value === null ? '(空值)' : ''}</li>`;
                        });
                        
                        structureHTML += `</ul>`;
                    }
                }
                
                structureViewer.innerHTML = structureHTML;
            }
            
            // 工具函数
            function isDataEmpty() {
                for (const category in parsedData) {
                    if (parsedData[category].length > 0) {
                        return false;
                    }
                }
                return true;
            }
            
            function getTotalItems() {
                let total = 0;
                for (const category in parsedData) {
                    total += parsedData[category].length;
                }
                return total;
            }
            
            function calculateStats(data) {
                if (data.length === 0) return { uniqueKeys: 0, avgProps: 0, maxDepth: 0 };
                
                // 收集所有唯一键
                const allKeys = new Set();
                let totalProps = 0;
                let maxDepth = 0;
                
                data.forEach(item => {
                    const keys = Object.keys(item);
                    keys.forEach(key => allKeys.add(key));
                    totalProps += keys.length;
                    
                    // 计算嵌套深度
                    const depth = calculateObjectDepth(item);
                    if (depth > maxDepth) maxDepth = depth;
                });
                
                return {
                    uniqueKeys: allKeys.size,
                    avgProps: Math.round(totalProps / data.length),
                    maxDepth: maxDepth
                };
            }
            
            function calculateObjectDepth(obj) {
                if (typeof obj !== 'object' || obj === null) return 0;
                
                let depth = 0;
                for (const key in obj) {
                    if (obj.hasOwnProperty(key)) {
                        const childDepth = calculateObjectDepth(obj[key]);
                        depth = Math.max(depth, childDepth);
                    }
                }
                
                return depth + 1;
            }
            
            function truncateText(text, maxLength) {
                if (text.length <= maxLength) return text;
                return text.substring(0, maxLength) + '...';
            }
            
            function capitalizeFirstLetter(string) {
                return string.charAt(0).toUpperCase() + string.slice(1);
            }
            
            function showError(message) {
                errorMessage.textContent = message;
                errorMessage.style.display = 'block';
                successMessage.style.display = 'none';
            }
            
            function showSuccess(message) {
                successMessage.textContent = message;
                successMessage.style.display = 'block';
                errorMessage.style.display = 'none';
            }
        });
    </script>
</body>
</html>