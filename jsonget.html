<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSON文件分析解构与格式转换工具</title>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .upload-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .upload-area:hover, .upload-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .upload-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .file-list {
            margin-top: 20px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        
        .file-name {
            flex-grow: 1;
        }
        
        .file-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            margin-left: 10px;
        }
        
        .file-actions button:hover {
            color: var(--secondary-color);
        }
        
        .analysis-section {
            display: none;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .json-tree {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .comparison-result {
            margin-top: 20px;
        }
        
        .diff-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
        }
        
        .added {
            background-color: rgba(76, 201, 240, 0.2);
            border-left: 4px solid var(--success-color);
        }
        
        .removed {
            background-color: rgba(247, 37, 133, 0.2);
            border-left: 4px solid var(--warning-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .conversion-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .conversion-result {
            margin-top: 20px;
        }
        
        .converted-content {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }
        
        .download-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .download-btn:hover {
            background-color: #3aa8d0;
        }
        
        select, button {
            padding: 8px 12px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .upload-area {
                padding: 20px 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>JSON文件分析解构与格式转换工具</h1>
            <p class="description">上传多个JSON文件，分析其结构、比较差异、可视化数据并转换为其他格式</p>
        </header>
        
        <section class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">📁</div>
                <h3>拖放JSON文件到此处或点击上传</h3>
                <p>支持多个文件同时上传，单个文件大小不超过10MB</p>
                <input type="file" id="fileInput" class="file-input" multiple accept=".json">
                <button class="upload-btn" id="uploadBtn">选择文件</button>
            </div>
            
            <div class="file-list" id="fileList">
                <!-- 上传的文件列表将在这里显示 -->
            </div>
        </section>
        
        <section class="analysis-section" id="analysisSection">
            <div class="tabs">
                <div class="tab active" data-tab="overview">概览</div>
                <div class="tab" data-tab="structure">结构分析</div>
                <div class="tab" data-tab="comparison">文件比较</div>
                <div class="tab" data-tab="visualization">数据可视化</div>
                <div class="tab" data-tab="conversion">格式转换</div>
            </div>
            
            <div class="tab-content active" id="overview">
                <h3>文件概览</h3>
                <div class="stats-grid" id="statsGrid">
                    <!-- 统计信息将在这里显示 -->
                </div>
                <div id="overviewContent">
                    <!-- 概览内容将在这里显示 -->
                </div>
            </div>
            
            <div class="tab-content" id="structure">
                <h3>JSON结构分析</h3>
                <select id="fileSelector">
                    <!-- 文件选择器选项将在这里动态添加 -->
                </select>
                <div class="json-tree" id="jsonTree">
                    <!-- JSON树形结构将在这里显示 -->
                </div>
            </div>
            
            <div class="tab-content" id="comparison">
                <h3>文件比较</h3>
                <div class="conversion-controls">
                    <select id="compareFile1">
                        <!-- 比较文件1选择器 -->
                    </select>
                    <span>与</span>
                    <select id="compareFile2">
                        <!-- 比较文件2选择器 -->
                    </select>
                    <button id="compareBtn">比较</button>
                </div>
                <div class="comparison-result" id="comparisonResult">
                    <!-- 比较结果将在这里显示 -->
                </div>
            </div>
            
            <div class="tab-content" id="visualization">
                <h3>数据可视化</h3>
                <select id="vizFileSelector">
                    <!-- 可视化文件选择器 -->
                </select>
                <div id="visualizationContainer">
                    <!-- 可视化图表将在这里显示 -->
                </div>
            </div>
            
            <div class="tab-content" id="conversion">
                <h3>格式转换</h3>
                <div class="conversion-controls">
                    <select id="convertFileSelector">
                        <!-- 转换文件选择器 -->
                    </select>
                    <select id="targetFormat">
                        <option value="csv">CSV</option>
                        <option value="xml">XML</option>
                        <option value="yaml">YAML</option>
                        <option value="txt">纯文本</option>
                    </select>
                    <button id="convertBtn">转换</button>
                </div>
                <div class="conversion-result" id="conversionResult">
                    <!-- 转换结果将在这里显示 -->
                </div>
            </div>
        </section>
        
        <footer>
            <p>JSON文件分析解构与格式转换工具 &copy; 2023 - 使用纯HTML、CSS和JavaScript构建</p>
        </footer>
    </div>

    <script>
        // 全局变量
        let uploadedFiles = [];
        
        // DOM元素
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileList = document.getElementById('fileList');
        const analysisSection = document.getElementById('analysisSection');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const fileSelector = document.getElementById('fileSelector');
        const jsonTree = document.getElementById('jsonTree');
        const compareFile1 = document.getElementById('compareFile1');
        const compareFile2 = document.getElementById('compareFile2');
        const compareBtn = document.getElementById('compareBtn');
        const comparisonResult = document.getElementById('comparisonResult');
        const vizFileSelector = document.getElementById('vizFileSelector');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const statsGrid = document.getElementById('statsGrid');
        const overviewContent = document.getElementById('overviewContent');
        const convertFileSelector = document.getElementById('convertFileSelector');
        const targetFormat = document.getElementById('targetFormat');
        const convertBtn = document.getElementById('convertBtn');
        const conversionResult = document.getElementById('conversionResult');
        
        // 事件监听器
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        
        // 标签页切换
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // 移除所有活动标签
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // 激活当前标签
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                // 根据标签更新内容
                if (tabId === 'structure') {
                    updateFileSelector();
                    displayJsonStructure();
                } else if (tabId === 'comparison') {
                    updateComparisonSelectors();
                } else if (tabId === 'visualization') {
                    updateVizFileSelector();
                    displayVisualization();
                } else if (tabId === 'overview') {
                    displayOverview();
                } else if (tabId === 'conversion') {
                    updateConversionSelectors();
                }
            });
        });
        
        // 文件比较
        compareBtn.addEventListener('click', compareFiles);
        
        // 格式转换
        convertBtn.addEventListener('click', convertFile);
        
        // 文件选择处理
        function handleFileSelect(e) {
            const files = e.target.files;
            processFiles(files);
        }
        
        // 拖放处理
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            processFiles(files);
        }
        
        // 处理上传的文件
        function processFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // 检查文件类型
                if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                    alert(`文件 "${file.name}" 不是有效的JSON文件`);
                    continue;
                }
                
                // 检查文件大小 (限制10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`文件 "${file.name}" 太大，请选择小于10MB的文件`);
                    continue;
                }
                
                // 读取文件内容
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const content = JSON.parse(e.target.result);
                        
                        // 添加到上传文件列表
                        uploadedFiles.push({
                            name: file.name,
                            content: content,
                            size: file.size,
                            lastModified: file.lastModified
                        });
                        
                        // 更新文件列表显示
                        updateFileList();
                        
                        // 显示分析区域
                        analysisSection.style.display = 'block';
                        
                        // 更新概览
                        displayOverview();
                    } catch (error) {
                        alert(`解析文件 "${file.name}" 时出错: ${error.message}`);
                    }
                };
                reader.readAsText(file);
            }
            
            // 重置文件输入，允许重复选择相同文件
            fileInput.value = '';
        }
        
        // 更新文件列表显示
        function updateFileList() {
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                fileItem.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-actions">
                        <button class="view-btn" data-index="${index}">查看</button>
                        <button class="remove-btn" data-index="${index}">移除</button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
            
            // 添加查看和移除按钮的事件监听器
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    // 切换到结构分析标签并显示选中的文件
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    document.querySelector('[data-tab="structure"]').classList.add('active');
                    document.getElementById('structure').classList.add('active');
                    
                    // 设置文件选择器
                    updateFileSelector();
                    fileSelector.value = index;
                    displayJsonStructure();
                });
            });
            
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    uploadedFiles.splice(index, 1);
                    updateFileList();
                    
                    // 如果没有文件了，隐藏分析区域
                    if (uploadedFiles.length === 0) {
                        analysisSection.style.display = 'none';
                    } else {
                        // 更新其他部分
                        displayOverview();
                    }
                });
            });
        }
        
        // 更新文件选择器
        function updateFileSelector() {
            fileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                fileSelector.appendChild(option);
            });
            
            fileSelector.addEventListener('change', displayJsonStructure);
        }
        
        // 更新比较选择器
        function updateComparisonSelectors() {
            compareFile1.innerHTML = '';
            compareFile2.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option1 = document.createElement('option');
                option1.value = index;
                option1.textContent = file.name;
                compareFile1.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = index;
                option2.textContent = file.name;
                compareFile2.appendChild(option2);
            });
            
            // 默认选择不同的文件进行比较
            if (uploadedFiles.length > 1) {
                compareFile2.value = 1;
            }
        }
        
        // 更新可视化文件选择器
        function updateVizFileSelector() {
            vizFileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                vizFileSelector.appendChild(option);
            });
            
            vizFileSelector.addEventListener('change', displayVisualization);
        }
        
        // 更新转换文件选择器
        function updateConversionSelectors() {
            convertFileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                convertFileSelector.appendChild(option);
            });
        }
        
        // 显示JSON结构
        function displayJsonStructure() {
            const selectedIndex = fileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            jsonTree.textContent = JSON.stringify(file.content, null, 2);
        }
        
        // 显示概览
        function displayOverview() {
            // 更新统计信息
            statsGrid.innerHTML = '';
            
            if (uploadedFiles.length === 0) return;
            
            // 总文件数
            const totalFilesCard = document.createElement('div');
            totalFilesCard.className = 'stat-card';
            totalFilesCard.innerHTML = `
                <div class="stat-value">${uploadedFiles.length}</div>
                <div class="stat-label">文件数量</div>
            `;
            statsGrid.appendChild(totalFilesCard);
            
            // 平均文件大小
            const totalSize = uploadedFiles.reduce((sum, file) => sum + file.size, 0);
            const avgSize = totalSize / uploadedFiles.length;
            const avgSizeCard = document.createElement('div');
            avgSizeCard.className = 'stat-card';
            avgSizeCard.innerHTML = `
                <div class="stat-value">${formatFileSize(avgSize)}</div>
                <div class="stat-label">平均大小</div>
            `;
            statsGrid.appendChild(avgSizeCard);
            
            // 最深层级
            let maxDepth = 0;
            uploadedFiles.forEach(file => {
                const depth = calculateDepth(file.content);
                if (depth > maxDepth) maxDepth = depth;
            });
            
            const depthCard = document.createElement('div');
            depthCard.className = 'stat-card';
            depthCard.innerHTML = `
                <div class="stat-value">${maxDepth}</div>
                <div class="stat-label">最深层级</div>
            `;
            statsGrid.appendChild(depthCard);
            
            // 键数量最多的文件
            let maxKeys = 0;
            let maxKeysFile = '';
            uploadedFiles.forEach(file => {
                const keyCount = countKeys(file.content);
                if (keyCount > maxKeys) {
                    maxKeys = keyCount;
                    maxKeysFile = file.name;
                }
            });
            
            const keysCard = document.createElement('div');
            keysCard.className = 'stat-card';
            keysCard.innerHTML = `
                <div class="stat-value">${maxKeys}</div>
                <div class="stat-label">最多键数量</div>
            `;
            statsGrid.appendChild(keysCard);
            
            // 显示文件列表和基本信息
            overviewContent.innerHTML = '<h4>文件详情</h4>';
            
            uploadedFiles.forEach(file => {
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-item';
                fileInfo.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-details">
                        <span>大小: ${formatFileSize(file.size)}</span>
                        <span>键数量: ${countKeys(file.content)}</span>
                        <span>深度: ${calculateDepth(file.content)}</span>
                    </div>
                `;
                overviewContent.appendChild(fileInfo);
            });
        }
        
        // 比较文件
        function compareFiles() {
            const index1 = compareFile1.value;
            const index2 = compareFile2.value;
            
            if (index1 === index2) {
                comparisonResult.innerHTML = '<p>请选择两个不同的文件进行比较</p>';
                return;
            }
            
            const file1 = uploadedFiles[index1];
            const file2 = uploadedFiles[index2];
            
            // 简单的差异检测
            const differences = findDifferences(file1.content, file2.content);
            
            comparisonResult.innerHTML = '';
            
            if (differences.length === 0) {
                comparisonResult.innerHTML = '<p>两个文件内容相同</p>';
                return;
            }
            
            differences.forEach(diff => {
                const diffItem = document.createElement('div');
                diffItem.className = `diff-item ${diff.type}`;
                
                if (diff.type === 'added') {
                    diffItem.innerHTML = `<strong>新增:</strong> ${diff.path} = ${JSON.stringify(diff.value)}`;
                } else if (diff.type === 'removed') {
                    diffItem.innerHTML = `<strong>删除:</strong> ${diff.path} = ${JSON.stringify(diff.value)}`;
                } else if (diff.type === 'modified') {
                    diffItem.innerHTML = `<strong>修改:</strong> ${diff.path} 从 ${JSON.stringify(diff.oldValue)} 变为 ${JSON.stringify(diff.newValue)}`;
                }
                
                comparisonResult.appendChild(diffItem);
            });
        }
        
        // 显示可视化
        function displayVisualization() {
            const selectedIndex = vizFileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            
            // 简单的可视化 - 显示键的类型分布
            const typeCounts = countValueTypes(file.content);
            
            visualizationContainer.innerHTML = `
                <h4>${file.name} 数据类型分布</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    ${Object.entries(typeCounts).map(([type, count]) => `
                        <div style="background: var(--primary-color); color: white; padding: 10px; border-radius: 5px;">
                            ${type}: ${count}
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 30px;">
                    <h4>数据结构预览</h4>
                    <div style="background: #f0f0f0; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                        <pre>${JSON.stringify(file.content, null, 2)}</pre>
                    </div>
                </div>
            `;
        }
        
        // 格式转换
        function convertFile() {
            const selectedIndex = convertFileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            const format = targetFormat.value;
            
            let convertedContent = '';
            let fileExtension = '';
            
            try {
                switch (format) {
                    case 'csv':
                        convertedContent = jsonToCsv(file.content);
                        fileExtension = 'csv';
                        break;
                    case 'xml':
                        convertedContent = jsonToXml(file.content);
                        fileExtension = 'xml';
                        break;
                    case 'yaml':
                        convertedContent = jsonToYaml(file.content);
                        fileExtension = 'yaml';
                        break;
                    case 'txt':
                        convertedContent = JSON.stringify(file.content, null, 2);
                        fileExtension = 'txt';
                        break;
                    default:
                        throw new Error('不支持的格式');
                }
                
                // 显示转换结果
                conversionResult.innerHTML = `
                    <h4>转换结果 (${format.toUpperCase()})</h4>
                    <div class="converted-content">${convertedContent}</div>
                    <button class="download-btn" id="downloadBtn">下载 ${file.name.split('.')[0]}.${fileExtension}</button>
                `;
                
                // 添加下载功能
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    downloadFile(convertedContent, `${file.name.split('.')[0]}.${fileExtension}`, `text/${format}`);
                });
                
            } catch (error) {
                conversionResult.innerHTML = `<p>转换失败: ${error.message}</p>`;
            }
        }
        
        // 辅助函数
        
        // 格式化文件大小
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // 计算JSON深度
        function calculateDepth(obj, currentDepth = 0) {
            if (typeof obj !== 'object' || obj === null) return currentDepth;
            
            let maxDepth = currentDepth;
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const depth = calculateDepth(obj[key], currentDepth + 1);
                    if (depth > maxDepth) maxDepth = depth;
                }
            }
            
            return maxDepth;
        }
        
        // 计算键的数量
        function countKeys(obj) {
            if (typeof obj !== 'object' || obj === null) return 0;
            
            let count = Object.keys(obj).length;
            for (let key in obj) {
                if (obj.hasOwnProperty(key) && typeof obj[key] === 'object' && obj[key] !== null) {
                    count += countKeys(obj[key]);
                }
            }
            
            return count;
        }
        
        // 查找差异
        function findDifferences(obj1, obj2, path = '') {
            const differences = [];
            
            // 获取所有键
            const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);
            
            allKeys.forEach(key => {
                const currentPath = path ? `${path}.${key}` : key;
                const val1 = obj1[key];
                const val2 = obj2[key];
                
                // 键在obj1中但不在obj2中
                if (key in obj1 && !(key in obj2)) {
                    differences.push({
                        type: 'removed',
                        path: currentPath,
                        value: val1
                    });
                }
                // 键在obj2中但不在obj1中
                else if (!(key in obj1) && key in obj2) {
                    differences.push({
                        type: 'added',
                        path: currentPath,
                        value: val2
                    });
                }
                // 键在两个对象中，但值不同
                else if (JSON.stringify(val1) !== JSON.stringify(val2)) {
                    // 如果都是对象，递归比较
                    if (typeof val1 === 'object' && val1 !== null && 
                        typeof val2 === 'object' && val2 !== null) {
                        differences.push(...findDifferences(val1, val2, currentPath));
                    } else {
                        differences.push({
                            type: 'modified',
                            path: currentPath,
                            oldValue: val1,
                            newValue: val2
                        });
                    }
                }
            });
            
            return differences;
        }
        
        // 统计值类型
        function countValueTypes(obj, counts = {}) {
            if (!counts.string) counts.string = 0;
            if (!counts.number) counts.number = 0;
            if (!counts.boolean) counts.boolean = 0;
            if (!counts.object) counts.object = 0;
            if (!counts.array) counts.array = 0;
            if (!counts.null) counts.null = 0;
            
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    const type = Array.isArray(value) ? 'array' : 
                                 value === null ? 'null' : 
                                 typeof value;
                    
                    if (counts[type] !== undefined) {
                        counts[type]++;
                    }
                    
                    // 递归处理对象和数组
                    if (typeof value === 'object' && value !== null) {
                        countValueTypes(value, counts);
                    }
                }
            }
            
            return counts;
        }
        
        // JSON转CSV
        function jsonToCsv(json) {
            if (Array.isArray(json)) {
                if (json.length === 0) return '';
                
                // 获取所有可能的键
                const allKeys = [];
                json.forEach(item => {
                    Object.keys(item).forEach(key => {
                        if (!allKeys.includes(key)) allKeys.push(key);
                    });
                });
                
                // 生成CSV标题行
                let csv = allKeys.join(',') + '\n';
                
                // 生成数据行
                json.forEach(item => {
                    const row = allKeys.map(key => {
                        let value = item[key] !== undefined ? item[key] : '';
                        // 处理包含逗号、引号或换行符的值
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                            value = '"' + value.replace(/"/g, '""') + '"';
                        }
                        return value;
                    });
                    csv += row.join(',') + '\n';
                });
                
                return csv;
            } else {
                // 如果不是数组，将其视为单行数据
                const keys = Object.keys(json);
                let csv = keys.join(',') + '\n';
                
                const row = keys.map(key => {
                    let value = json[key];
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                
                csv += row.join(',');
                return csv;
            }
        }
        
        // JSON转XML
        function jsonToXml(json, rootName = 'root') {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            
            function parseValue(key, value) {
                if (typeof value === 'object' && value !== null) {
                    if (Array.isArray(value)) {
                        let arrayXml = '';
                        value.forEach((item, index) => {
                            arrayXml += parseValue(key, item);
                        });
                        return arrayXml;
                    } else {
                        let objXml = `<${key}>`;
                        for (let prop in value) {
                            if (value.hasOwnProperty(prop)) {
                                objXml += parseValue(prop, value[prop]);
                            }
                        }
                        objXml += `</${key}>\n`;
                        return objXml;
                    }
                } else {
                    return `<${key}>${value}</${key}>\n`;
                }
            }
            
            xml += `<${rootName}>\n`;
            xml += parseValue('data', json);
            xml += `</${rootName}>`;
            
            return xml;
        }
        
        // JSON转YAML
        function jsonToYaml(json, indent = 0) {
            const spaces = ' '.repeat(indent);
            let yaml = '';
            
            if (Array.isArray(json)) {
                json.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        yaml += spaces + '-\n';
                        yaml += jsonToYaml(item, indent + 2);
                    } else {
                        yaml += spaces + '- ' + item + '\n';
                    }
                });
            } else if (typeof json === 'object' && json !== null) {
                for (let key in json) {
                    if (json.hasOwnProperty(key)) {
                        const value = json[key];
                        if (typeof value === 'object' && value !== null) {
                            yaml += spaces + key + ':\n';
                            yaml += jsonToYaml(value, indent + 2);
                        } else {
                            yaml += spaces + key + ': ' + value + '\n';
                        }
                    }
                }
            } else {
                yaml += spaces + json + '\n';
            }
            
            return yaml;
        }
        
        // 下载文件
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>