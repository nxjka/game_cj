<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JSONæ–‡ä»¶åˆ†æè§£æ„ä¸æ ¼å¼è½¬æ¢å·¥å…·</title>
    <style>
        :root {
            --primary-color: #4361ee;
            --secondary-color: #3a0ca3;
            --light-color: #f8f9fa;
            --dark-color: #212529;
            --success-color: #4cc9f0;
            --warning-color: #f72585;
            --border-radius: 8px;
            --box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: #f5f7fb;
            color: var(--dark-color);
            line-height: 1.6;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        
        header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
            background: linear-gradient(135deg, var(--primary-color), var(--secondary-color));
            color: white;
            border-radius: var(--border-radius);
            box-shadow: var(--box-shadow);
        }
        
        h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
        }
        
        .description {
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
        }
        
        .upload-section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .upload-area {
            border: 2px dashed #ccc;
            border-radius: var(--border-radius);
            padding: 40px 20px;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            margin-bottom: 20px;
        }
        
        .upload-area:hover, .upload-area.drag-over {
            border-color: var(--primary-color);
            background-color: rgba(67, 97, 238, 0.05);
        }
        
        .upload-icon {
            font-size: 48px;
            color: var(--primary-color);
            margin-bottom: 15px;
        }
        
        .file-input {
            display: none;
        }
        
        .upload-btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .upload-btn:hover {
            background-color: var(--secondary-color);
        }
        
        .file-list {
            margin-top: 20px;
        }
        
        .file-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: var(--light-color);
            border-radius: var(--border-radius);
            margin-bottom: 10px;
        }
        
        .file-name {
            flex-grow: 1;
        }
        
        .file-actions button {
            background: none;
            border: none;
            cursor: pointer;
            color: var(--primary-color);
            margin-left: 10px;
        }
        
        .file-actions button:hover {
            color: var(--secondary-color);
        }
        
        .analysis-section {
            display: none;
            background-color: white;
            border-radius: var(--border-radius);
            padding: 30px;
            margin-bottom: 30px;
            box-shadow: var(--box-shadow);
        }
        
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            border-bottom: 3px solid transparent;
        }
        
        .tab.active {
            border-bottom: 3px solid var(--primary-color);
            color: var(--primary-color);
            font-weight: bold;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .json-tree {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
        }
        
        .comparison-result {
            margin-top: 20px;
        }
        
        .diff-item {
            padding: 10px;
            margin-bottom: 10px;
            border-radius: var(--border-radius);
        }
        
        .added {
            background-color: rgba(76, 201, 240, 0.2);
            border-left: 4px solid var(--success-color);
        }
        
        .removed {
            background-color: rgba(247, 37, 133, 0.2);
            border-left: 4px solid var(--warning-color);
        }
        
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .stat-card {
            background-color: var(--light-color);
            padding: 15px;
            border-radius: var(--border-radius);
            text-align: center;
        }
        
        .stat-value {
            font-size: 1.8rem;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .stat-label {
            font-size: 0.9rem;
            color: #666;
        }
        
        .conversion-controls {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 20px;
            align-items: center;
        }
        
        .conversion-result {
            margin-top: 20px;
        }
        
        .converted-content {
            font-family: 'Courier New', Courier, monospace;
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: var(--border-radius);
            max-height: 500px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin-bottom: 15px;
        }
        
        .download-btn {
            background-color: var(--success-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            cursor: pointer;
            font-size: 1rem;
            transition: background-color 0.3s;
        }
        
        .download-btn:hover {
            background-color: #3aa8d0;
        }
        
        select, button {
            padding: 8px 12px;
            border-radius: var(--border-radius);
            border: 1px solid #ddd;
        }
        
        footer {
            text-align: center;
            margin-top: 40px;
            padding: 20px;
            color: #666;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .container {
                padding: 10px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .upload-area {
                padding: 20px 10px;
            }
            
            .stats-grid {
                grid-template-columns: 1fr 1fr;
            }
            
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                text-align: center;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>JSONæ–‡ä»¶åˆ†æè§£æ„ä¸æ ¼å¼è½¬æ¢å·¥å…·</h1>
            <p class="description">ä¸Šä¼ å¤šä¸ªJSONæ–‡ä»¶ï¼Œåˆ†æå…¶ç»“æ„ã€æ¯”è¾ƒå·®å¼‚ã€å¯è§†åŒ–æ•°æ®å¹¶è½¬æ¢ä¸ºå…¶ä»–æ ¼å¼</p>
        </header>
        
        <section class="upload-section">
            <div class="upload-area" id="uploadArea">
                <div class="upload-icon">ğŸ“</div>
                <h3>æ‹–æ”¾JSONæ–‡ä»¶åˆ°æ­¤å¤„æˆ–ç‚¹å‡»ä¸Šä¼ </h3>
                <p>æ”¯æŒå¤šä¸ªæ–‡ä»¶åŒæ—¶ä¸Šä¼ ï¼Œå•ä¸ªæ–‡ä»¶å¤§å°ä¸è¶…è¿‡10MB</p>
                <input type="file" id="fileInput" class="file-input" multiple accept=".json">
                <button class="upload-btn" id="uploadBtn">é€‰æ‹©æ–‡ä»¶</button>
            </div>
            
            <div class="file-list" id="fileList">
                <!-- ä¸Šä¼ çš„æ–‡ä»¶åˆ—è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
            </div>
        </section>
        
        <section class="analysis-section" id="analysisSection">
            <div class="tabs">
                <div class="tab active" data-tab="overview">æ¦‚è§ˆ</div>
                <div class="tab" data-tab="structure">ç»“æ„åˆ†æ</div>
                <div class="tab" data-tab="comparison">æ–‡ä»¶æ¯”è¾ƒ</div>
                <div class="tab" data-tab="visualization">æ•°æ®å¯è§†åŒ–</div>
                <div class="tab" data-tab="conversion">æ ¼å¼è½¬æ¢</div>
            </div>
            
            <div class="tab-content active" id="overview">
                <h3>æ–‡ä»¶æ¦‚è§ˆ</h3>
                <div class="stats-grid" id="statsGrid">
                    <!-- ç»Ÿè®¡ä¿¡æ¯å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
                <div id="overviewContent">
                    <!-- æ¦‚è§ˆå†…å®¹å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="tab-content" id="structure">
                <h3>JSONç»“æ„åˆ†æ</h3>
                <select id="fileSelector">
                    <!-- æ–‡ä»¶é€‰æ‹©å™¨é€‰é¡¹å°†åœ¨è¿™é‡ŒåŠ¨æ€æ·»åŠ  -->
                </select>
                <div class="json-tree" id="jsonTree">
                    <!-- JSONæ ‘å½¢ç»“æ„å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="tab-content" id="comparison">
                <h3>æ–‡ä»¶æ¯”è¾ƒ</h3>
                <div class="conversion-controls">
                    <select id="compareFile1">
                        <!-- æ¯”è¾ƒæ–‡ä»¶1é€‰æ‹©å™¨ -->
                    </select>
                    <span>ä¸</span>
                    <select id="compareFile2">
                        <!-- æ¯”è¾ƒæ–‡ä»¶2é€‰æ‹©å™¨ -->
                    </select>
                    <button id="compareBtn">æ¯”è¾ƒ</button>
                </div>
                <div class="comparison-result" id="comparisonResult">
                    <!-- æ¯”è¾ƒç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="tab-content" id="visualization">
                <h3>æ•°æ®å¯è§†åŒ–</h3>
                <select id="vizFileSelector">
                    <!-- å¯è§†åŒ–æ–‡ä»¶é€‰æ‹©å™¨ -->
                </select>
                <div id="visualizationContainer">
                    <!-- å¯è§†åŒ–å›¾è¡¨å°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
            
            <div class="tab-content" id="conversion">
                <h3>æ ¼å¼è½¬æ¢</h3>
                <div class="conversion-controls">
                    <select id="convertFileSelector">
                        <!-- è½¬æ¢æ–‡ä»¶é€‰æ‹©å™¨ -->
                    </select>
                    <select id="targetFormat">
                        <option value="csv">CSV</option>
                        <option value="xml">XML</option>
                        <option value="yaml">YAML</option>
                        <option value="txt">çº¯æ–‡æœ¬</option>
                    </select>
                    <button id="convertBtn">è½¬æ¢</button>
                </div>
                <div class="conversion-result" id="conversionResult">
                    <!-- è½¬æ¢ç»“æœå°†åœ¨è¿™é‡Œæ˜¾ç¤º -->
                </div>
            </div>
        </section>
        
        <footer>
            <p>JSONæ–‡ä»¶åˆ†æè§£æ„ä¸æ ¼å¼è½¬æ¢å·¥å…· &copy; 2023 - ä½¿ç”¨çº¯HTMLã€CSSå’ŒJavaScriptæ„å»º</p>
        </footer>
    </div>

    <script>
        // å…¨å±€å˜é‡
        let uploadedFiles = [];
        
        // DOMå…ƒç´ 
        const uploadArea = document.getElementById('uploadArea');
        const fileInput = document.getElementById('fileInput');
        const uploadBtn = document.getElementById('uploadBtn');
        const fileList = document.getElementById('fileList');
        const analysisSection = document.getElementById('analysisSection');
        const tabs = document.querySelectorAll('.tab');
        const tabContents = document.querySelectorAll('.tab-content');
        const fileSelector = document.getElementById('fileSelector');
        const jsonTree = document.getElementById('jsonTree');
        const compareFile1 = document.getElementById('compareFile1');
        const compareFile2 = document.getElementById('compareFile2');
        const compareBtn = document.getElementById('compareBtn');
        const comparisonResult = document.getElementById('comparisonResult');
        const vizFileSelector = document.getElementById('vizFileSelector');
        const visualizationContainer = document.getElementById('visualizationContainer');
        const statsGrid = document.getElementById('statsGrid');
        const overviewContent = document.getElementById('overviewContent');
        const convertFileSelector = document.getElementById('convertFileSelector');
        const targetFormat = document.getElementById('targetFormat');
        const convertBtn = document.getElementById('convertBtn');
        const conversionResult = document.getElementById('conversionResult');
        
        // äº‹ä»¶ç›‘å¬å™¨
        uploadBtn.addEventListener('click', () => fileInput.click());
        fileInput.addEventListener('change', handleFileSelect);
        uploadArea.addEventListener('dragover', handleDragOver);
        uploadArea.addEventListener('dragleave', handleDragLeave);
        uploadArea.addEventListener('drop', handleDrop);
        
        // æ ‡ç­¾é¡µåˆ‡æ¢
        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                const tabId = tab.getAttribute('data-tab');
                
                // ç§»é™¤æ‰€æœ‰æ´»åŠ¨æ ‡ç­¾
                tabs.forEach(t => t.classList.remove('active'));
                tabContents.forEach(c => c.classList.remove('active'));
                
                // æ¿€æ´»å½“å‰æ ‡ç­¾
                tab.classList.add('active');
                document.getElementById(tabId).classList.add('active');
                
                // æ ¹æ®æ ‡ç­¾æ›´æ–°å†…å®¹
                if (tabId === 'structure') {
                    updateFileSelector();
                    displayJsonStructure();
                } else if (tabId === 'comparison') {
                    updateComparisonSelectors();
                } else if (tabId === 'visualization') {
                    updateVizFileSelector();
                    displayVisualization();
                } else if (tabId === 'overview') {
                    displayOverview();
                } else if (tabId === 'conversion') {
                    updateConversionSelectors();
                }
            });
        });
        
        // æ–‡ä»¶æ¯”è¾ƒ
        compareBtn.addEventListener('click', compareFiles);
        
        // æ ¼å¼è½¬æ¢
        convertBtn.addEventListener('click', convertFile);
        
        // æ–‡ä»¶é€‰æ‹©å¤„ç†
        function handleFileSelect(e) {
            const files = e.target.files;
            processFiles(files);
        }
        
        // æ‹–æ”¾å¤„ç†
        function handleDragOver(e) {
            e.preventDefault();
            uploadArea.classList.add('drag-over');
        }
        
        function handleDragLeave(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
        }
        
        function handleDrop(e) {
            e.preventDefault();
            uploadArea.classList.remove('drag-over');
            const files = e.dataTransfer.files;
            processFiles(files);
        }
        
        // å¤„ç†ä¸Šä¼ çš„æ–‡ä»¶
        function processFiles(files) {
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // æ£€æŸ¥æ–‡ä»¶ç±»å‹
                if (file.type !== 'application/json' && !file.name.endsWith('.json')) {
                    alert(`æ–‡ä»¶ "${file.name}" ä¸æ˜¯æœ‰æ•ˆçš„JSONæ–‡ä»¶`);
                    continue;
                }
                
                // æ£€æŸ¥æ–‡ä»¶å¤§å° (é™åˆ¶10MB)
                if (file.size > 10 * 1024 * 1024) {
                    alert(`æ–‡ä»¶ "${file.name}" å¤ªå¤§ï¼Œè¯·é€‰æ‹©å°äº10MBçš„æ–‡ä»¶`);
                    continue;
                }
                
                // è¯»å–æ–‡ä»¶å†…å®¹
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const content = JSON.parse(e.target.result);
                        
                        // æ·»åŠ åˆ°ä¸Šä¼ æ–‡ä»¶åˆ—è¡¨
                        uploadedFiles.push({
                            name: file.name,
                            content: content,
                            size: file.size,
                            lastModified: file.lastModified
                        });
                        
                        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
                        updateFileList();
                        
                        // æ˜¾ç¤ºåˆ†æåŒºåŸŸ
                        analysisSection.style.display = 'block';
                        
                        // æ›´æ–°æ¦‚è§ˆ
                        displayOverview();
                    } catch (error) {
                        alert(`è§£ææ–‡ä»¶ "${file.name}" æ—¶å‡ºé”™: ${error.message}`);
                    }
                };
                reader.readAsText(file);
            }
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥ï¼Œå…è®¸é‡å¤é€‰æ‹©ç›¸åŒæ–‡ä»¶
            fileInput.value = '';
        }
        
        // æ›´æ–°æ–‡ä»¶åˆ—è¡¨æ˜¾ç¤º
        function updateFileList() {
            fileList.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const fileItem = document.createElement('div');
                fileItem.className = 'file-item';
                
                fileItem.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-actions">
                        <button class="view-btn" data-index="${index}">æŸ¥çœ‹</button>
                        <button class="remove-btn" data-index="${index}">ç§»é™¤</button>
                    </div>
                `;
                
                fileList.appendChild(fileItem);
            });
            
            // æ·»åŠ æŸ¥çœ‹å’Œç§»é™¤æŒ‰é’®çš„äº‹ä»¶ç›‘å¬å™¨
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    // åˆ‡æ¢åˆ°ç»“æ„åˆ†ææ ‡ç­¾å¹¶æ˜¾ç¤ºé€‰ä¸­çš„æ–‡ä»¶
                    tabs.forEach(t => t.classList.remove('active'));
                    tabContents.forEach(c => c.classList.remove('active'));
                    
                    document.querySelector('[data-tab="structure"]').classList.add('active');
                    document.getElementById('structure').classList.add('active');
                    
                    // è®¾ç½®æ–‡ä»¶é€‰æ‹©å™¨
                    updateFileSelector();
                    fileSelector.value = index;
                    displayJsonStructure();
                });
            });
            
            document.querySelectorAll('.remove-btn').forEach(btn => {
                btn.addEventListener('click', (e) => {
                    const index = e.target.getAttribute('data-index');
                    uploadedFiles.splice(index, 1);
                    updateFileList();
                    
                    // å¦‚æœæ²¡æœ‰æ–‡ä»¶äº†ï¼Œéšè—åˆ†æåŒºåŸŸ
                    if (uploadedFiles.length === 0) {
                        analysisSection.style.display = 'none';
                    } else {
                        // æ›´æ–°å…¶ä»–éƒ¨åˆ†
                        displayOverview();
                    }
                });
            });
        }
        
        // æ›´æ–°æ–‡ä»¶é€‰æ‹©å™¨
        function updateFileSelector() {
            fileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                fileSelector.appendChild(option);
            });
            
            fileSelector.addEventListener('change', displayJsonStructure);
        }
        
        // æ›´æ–°æ¯”è¾ƒé€‰æ‹©å™¨
        function updateComparisonSelectors() {
            compareFile1.innerHTML = '';
            compareFile2.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option1 = document.createElement('option');
                option1.value = index;
                option1.textContent = file.name;
                compareFile1.appendChild(option1);
                
                const option2 = document.createElement('option');
                option2.value = index;
                option2.textContent = file.name;
                compareFile2.appendChild(option2);
            });
            
            // é»˜è®¤é€‰æ‹©ä¸åŒçš„æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒ
            if (uploadedFiles.length > 1) {
                compareFile2.value = 1;
            }
        }
        
        // æ›´æ–°å¯è§†åŒ–æ–‡ä»¶é€‰æ‹©å™¨
        function updateVizFileSelector() {
            vizFileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                vizFileSelector.appendChild(option);
            });
            
            vizFileSelector.addEventListener('change', displayVisualization);
        }
        
        // æ›´æ–°è½¬æ¢æ–‡ä»¶é€‰æ‹©å™¨
        function updateConversionSelectors() {
            convertFileSelector.innerHTML = '';
            
            uploadedFiles.forEach((file, index) => {
                const option = document.createElement('option');
                option.value = index;
                option.textContent = file.name;
                convertFileSelector.appendChild(option);
            });
        }
        
        // æ˜¾ç¤ºJSONç»“æ„
        function displayJsonStructure() {
            const selectedIndex = fileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            jsonTree.textContent = JSON.stringify(file.content, null, 2);
        }
        
        // æ˜¾ç¤ºæ¦‚è§ˆ
        function displayOverview() {
            // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
            statsGrid.innerHTML = '';
            
            if (uploadedFiles.length === 0) return;
            
            // æ€»æ–‡ä»¶æ•°
            const totalFilesCard = document.createElement('div');
            totalFilesCard.className = 'stat-card';
            totalFilesCard.innerHTML = `
                <div class="stat-value">${uploadedFiles.length}</div>
                <div class="stat-label">æ–‡ä»¶æ•°é‡</div>
            `;
            statsGrid.appendChild(totalFilesCard);
            
            // å¹³å‡æ–‡ä»¶å¤§å°
            const totalSize = uploadedFiles.reduce((sum, file) => sum + file.size, 0);
            const avgSize = totalSize / uploadedFiles.length;
            const avgSizeCard = document.createElement('div');
            avgSizeCard.className = 'stat-card';
            avgSizeCard.innerHTML = `
                <div class="stat-value">${formatFileSize(avgSize)}</div>
                <div class="stat-label">å¹³å‡å¤§å°</div>
            `;
            statsGrid.appendChild(avgSizeCard);
            
            // æœ€æ·±å±‚çº§
            let maxDepth = 0;
            uploadedFiles.forEach(file => {
                const depth = calculateDepth(file.content);
                if (depth > maxDepth) maxDepth = depth;
            });
            
            const depthCard = document.createElement('div');
            depthCard.className = 'stat-card';
            depthCard.innerHTML = `
                <div class="stat-value">${maxDepth}</div>
                <div class="stat-label">æœ€æ·±å±‚çº§</div>
            `;
            statsGrid.appendChild(depthCard);
            
            // é”®æ•°é‡æœ€å¤šçš„æ–‡ä»¶
            let maxKeys = 0;
            let maxKeysFile = '';
            uploadedFiles.forEach(file => {
                const keyCount = countKeys(file.content);
                if (keyCount > maxKeys) {
                    maxKeys = keyCount;
                    maxKeysFile = file.name;
                }
            });
            
            const keysCard = document.createElement('div');
            keysCard.className = 'stat-card';
            keysCard.innerHTML = `
                <div class="stat-value">${maxKeys}</div>
                <div class="stat-label">æœ€å¤šé”®æ•°é‡</div>
            `;
            statsGrid.appendChild(keysCard);
            
            // æ˜¾ç¤ºæ–‡ä»¶åˆ—è¡¨å’ŒåŸºæœ¬ä¿¡æ¯
            overviewContent.innerHTML = '<h4>æ–‡ä»¶è¯¦æƒ…</h4>';
            
            uploadedFiles.forEach(file => {
                const fileInfo = document.createElement('div');
                fileInfo.className = 'file-item';
                fileInfo.innerHTML = `
                    <div class="file-name">${file.name}</div>
                    <div class="file-details">
                        <span>å¤§å°: ${formatFileSize(file.size)}</span>
                        <span>é”®æ•°é‡: ${countKeys(file.content)}</span>
                        <span>æ·±åº¦: ${calculateDepth(file.content)}</span>
                    </div>
                `;
                overviewContent.appendChild(fileInfo);
            });
        }
        
        // æ¯”è¾ƒæ–‡ä»¶
        function compareFiles() {
            const index1 = compareFile1.value;
            const index2 = compareFile2.value;
            
            if (index1 === index2) {
                comparisonResult.innerHTML = '<p>è¯·é€‰æ‹©ä¸¤ä¸ªä¸åŒçš„æ–‡ä»¶è¿›è¡Œæ¯”è¾ƒ</p>';
                return;
            }
            
            const file1 = uploadedFiles[index1];
            const file2 = uploadedFiles[index2];
            
            // ç®€å•çš„å·®å¼‚æ£€æµ‹
            const differences = findDifferences(file1.content, file2.content);
            
            comparisonResult.innerHTML = '';
            
            if (differences.length === 0) {
                comparisonResult.innerHTML = '<p>ä¸¤ä¸ªæ–‡ä»¶å†…å®¹ç›¸åŒ</p>';
                return;
            }
            
            differences.forEach(diff => {
                const diffItem = document.createElement('div');
                diffItem.className = `diff-item ${diff.type}`;
                
                if (diff.type === 'added') {
                    diffItem.innerHTML = `<strong>æ–°å¢:</strong> ${diff.path} = ${JSON.stringify(diff.value)}`;
                } else if (diff.type === 'removed') {
                    diffItem.innerHTML = `<strong>åˆ é™¤:</strong> ${diff.path} = ${JSON.stringify(diff.value)}`;
                } else if (diff.type === 'modified') {
                    diffItem.innerHTML = `<strong>ä¿®æ”¹:</strong> ${diff.path} ä» ${JSON.stringify(diff.oldValue)} å˜ä¸º ${JSON.stringify(diff.newValue)}`;
                }
                
                comparisonResult.appendChild(diffItem);
            });
        }
        
        // æ˜¾ç¤ºå¯è§†åŒ–
        function displayVisualization() {
            const selectedIndex = vizFileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            
            // ç®€å•çš„å¯è§†åŒ– - æ˜¾ç¤ºé”®çš„ç±»å‹åˆ†å¸ƒ
            const typeCounts = countValueTypes(file.content);
            
            visualizationContainer.innerHTML = `
                <h4>${file.name} æ•°æ®ç±»å‹åˆ†å¸ƒ</h4>
                <div style="display: flex; flex-wrap: wrap; gap: 10px; margin-top: 20px;">
                    ${Object.entries(typeCounts).map(([type, count]) => `
                        <div style="background: var(--primary-color); color: white; padding: 10px; border-radius: 5px;">
                            ${type}: ${count}
                        </div>
                    `).join('')}
                </div>
                <div style="margin-top: 30px;">
                    <h4>æ•°æ®ç»“æ„é¢„è§ˆ</h4>
                    <div style="background: #f0f0f0; padding: 15px; border-radius: 5px; max-height: 300px; overflow-y: auto;">
                        <pre>${JSON.stringify(file.content, null, 2)}</pre>
                    </div>
                </div>
            `;
        }
        
        // æ ¼å¼è½¬æ¢
        function convertFile() {
            const selectedIndex = convertFileSelector.value;
            if (selectedIndex === '' || !uploadedFiles[selectedIndex]) return;
            
            const file = uploadedFiles[selectedIndex];
            const format = targetFormat.value;
            
            let convertedContent = '';
            let fileExtension = '';
            
            try {
                switch (format) {
                    case 'csv':
                        convertedContent = jsonToCsv(file.content);
                        fileExtension = 'csv';
                        break;
                    case 'xml':
                        convertedContent = jsonToXml(file.content);
                        fileExtension = 'xml';
                        break;
                    case 'yaml':
                        convertedContent = jsonToYaml(file.content);
                        fileExtension = 'yaml';
                        break;
                    case 'txt':
                        convertedContent = JSON.stringify(file.content, null, 2);
                        fileExtension = 'txt';
                        break;
                    default:
                        throw new Error('ä¸æ”¯æŒçš„æ ¼å¼');
                }
                
                // æ˜¾ç¤ºè½¬æ¢ç»“æœ
                conversionResult.innerHTML = `
                    <h4>è½¬æ¢ç»“æœ (${format.toUpperCase()})</h4>
                    <div class="converted-content">${convertedContent}</div>
                    <button class="download-btn" id="downloadBtn">ä¸‹è½½ ${file.name.split('.')[0]}.${fileExtension}</button>
                `;
                
                // æ·»åŠ ä¸‹è½½åŠŸèƒ½
                document.getElementById('downloadBtn').addEventListener('click', () => {
                    downloadFile(convertedContent, `${file.name.split('.')[0]}.${fileExtension}`, `text/${format}`);
                });
                
            } catch (error) {
                conversionResult.innerHTML = `<p>è½¬æ¢å¤±è´¥: ${error.message}</p>`;
            }
        }
        
        // è¾…åŠ©å‡½æ•°
        
        // æ ¼å¼åŒ–æ–‡ä»¶å¤§å°
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        // è®¡ç®—JSONæ·±åº¦
        function calculateDepth(obj, currentDepth = 0) {
            if (typeof obj !== 'object' || obj === null) return currentDepth;
            
            let maxDepth = currentDepth;
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const depth = calculateDepth(obj[key], currentDepth + 1);
                    if (depth > maxDepth) maxDepth = depth;
                }
            }
            
            return maxDepth;
        }
        
        // è®¡ç®—é”®çš„æ•°é‡
        function countKeys(obj) {
            if (typeof obj !== 'object' || obj === null) return 0;
            
            let count = Object.keys(obj).length;
            for (let key in obj) {
                if (obj.hasOwnProperty(key) && typeof obj[key] === 'object' && obj[key] !== null) {
                    count += countKeys(obj[key]);
                }
            }
            
            return count;
        }
        
        // æŸ¥æ‰¾å·®å¼‚
        function findDifferences(obj1, obj2, path = '') {
            const differences = [];
            
            // è·å–æ‰€æœ‰é”®
            const allKeys = new Set([...Object.keys(obj1), ...Object.keys(obj2)]);
            
            allKeys.forEach(key => {
                const currentPath = path ? `${path}.${key}` : key;
                const val1 = obj1[key];
                const val2 = obj2[key];
                
                // é”®åœ¨obj1ä¸­ä½†ä¸åœ¨obj2ä¸­
                if (key in obj1 && !(key in obj2)) {
                    differences.push({
                        type: 'removed',
                        path: currentPath,
                        value: val1
                    });
                }
                // é”®åœ¨obj2ä¸­ä½†ä¸åœ¨obj1ä¸­
                else if (!(key in obj1) && key in obj2) {
                    differences.push({
                        type: 'added',
                        path: currentPath,
                        value: val2
                    });
                }
                // é”®åœ¨ä¸¤ä¸ªå¯¹è±¡ä¸­ï¼Œä½†å€¼ä¸åŒ
                else if (JSON.stringify(val1) !== JSON.stringify(val2)) {
                    // å¦‚æœéƒ½æ˜¯å¯¹è±¡ï¼Œé€’å½’æ¯”è¾ƒ
                    if (typeof val1 === 'object' && val1 !== null && 
                        typeof val2 === 'object' && val2 !== null) {
                        differences.push(...findDifferences(val1, val2, currentPath));
                    } else {
                        differences.push({
                            type: 'modified',
                            path: currentPath,
                            oldValue: val1,
                            newValue: val2
                        });
                    }
                }
            });
            
            return differences;
        }
        
        // ç»Ÿè®¡å€¼ç±»å‹
        function countValueTypes(obj, counts = {}) {
            if (!counts.string) counts.string = 0;
            if (!counts.number) counts.number = 0;
            if (!counts.boolean) counts.boolean = 0;
            if (!counts.object) counts.object = 0;
            if (!counts.array) counts.array = 0;
            if (!counts.null) counts.null = 0;
            
            for (let key in obj) {
                if (obj.hasOwnProperty(key)) {
                    const value = obj[key];
                    const type = Array.isArray(value) ? 'array' : 
                                 value === null ? 'null' : 
                                 typeof value;
                    
                    if (counts[type] !== undefined) {
                        counts[type]++;
                    }
                    
                    // é€’å½’å¤„ç†å¯¹è±¡å’Œæ•°ç»„
                    if (typeof value === 'object' && value !== null) {
                        countValueTypes(value, counts);
                    }
                }
            }
            
            return counts;
        }
        
        // JSONè½¬CSV
        function jsonToCsv(json) {
            if (Array.isArray(json)) {
                if (json.length === 0) return '';
                
                // è·å–æ‰€æœ‰å¯èƒ½çš„é”®
                const allKeys = [];
                json.forEach(item => {
                    Object.keys(item).forEach(key => {
                        if (!allKeys.includes(key)) allKeys.push(key);
                    });
                });
                
                // ç”ŸæˆCSVæ ‡é¢˜è¡Œ
                let csv = allKeys.join(',') + '\n';
                
                // ç”Ÿæˆæ•°æ®è¡Œ
                json.forEach(item => {
                    const row = allKeys.map(key => {
                        let value = item[key] !== undefined ? item[key] : '';
                        // å¤„ç†åŒ…å«é€—å·ã€å¼•å·æˆ–æ¢è¡Œç¬¦çš„å€¼
                        if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                            value = '"' + value.replace(/"/g, '""') + '"';
                        }
                        return value;
                    });
                    csv += row.join(',') + '\n';
                });
                
                return csv;
            } else {
                // å¦‚æœä¸æ˜¯æ•°ç»„ï¼Œå°†å…¶è§†ä¸ºå•è¡Œæ•°æ®
                const keys = Object.keys(json);
                let csv = keys.join(',') + '\n';
                
                const row = keys.map(key => {
                    let value = json[key];
                    if (typeof value === 'string' && (value.includes(',') || value.includes('"') || value.includes('\n'))) {
                        value = '"' + value.replace(/"/g, '""') + '"';
                    }
                    return value;
                });
                
                csv += row.join(',');
                return csv;
            }
        }
        
        // JSONè½¬XML
        function jsonToXml(json, rootName = 'root') {
            let xml = '<?xml version="1.0" encoding="UTF-8"?>\n';
            
            function parseValue(key, value) {
                if (typeof value === 'object' && value !== null) {
                    if (Array.isArray(value)) {
                        let arrayXml = '';
                        value.forEach((item, index) => {
                            arrayXml += parseValue(key, item);
                        });
                        return arrayXml;
                    } else {
                        let objXml = `<${key}>`;
                        for (let prop in value) {
                            if (value.hasOwnProperty(prop)) {
                                objXml += parseValue(prop, value[prop]);
                            }
                        }
                        objXml += `</${key}>\n`;
                        return objXml;
                    }
                } else {
                    return `<${key}>${value}</${key}>\n`;
                }
            }
            
            xml += `<${rootName}>\n`;
            xml += parseValue('data', json);
            xml += `</${rootName}>`;
            
            return xml;
        }
        
        // JSONè½¬YAML
        function jsonToYaml(json, indent = 0) {
            const spaces = ' '.repeat(indent);
            let yaml = '';
            
            if (Array.isArray(json)) {
                json.forEach(item => {
                    if (typeof item === 'object' && item !== null) {
                        yaml += spaces + '-\n';
                        yaml += jsonToYaml(item, indent + 2);
                    } else {
                        yaml += spaces + '- ' + item + '\n';
                    }
                });
            } else if (typeof json === 'object' && json !== null) {
                for (let key in json) {
                    if (json.hasOwnProperty(key)) {
                        const value = json[key];
                        if (typeof value === 'object' && value !== null) {
                            yaml += spaces + key + ':\n';
                            yaml += jsonToYaml(value, indent + 2);
                        } else {
                            yaml += spaces + key + ': ' + value + '\n';
                        }
                    }
                }
            } else {
                yaml += spaces + json + '\n';
            }
            
            return yaml;
        }
        
        // ä¸‹è½½æ–‡ä»¶
        function downloadFile(content, filename, mimeType) {
            const blob = new Blob([content], { type: mimeType });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>